# MVP_SCOPE — Minila

## در این فاز چه می‌سازیم؟

### ثبت‌نام/ورود و داشبورد ساده

- ثبت‌نام/ورود با ایمیل + OTP و تأیید ایمیل (الزامی).
- داشبورد: خوش‌آمدگویی، درخواست عضویت در کامیونیتی، وضعیت درخواست‌های عضویت، دکمهٔ «ایجاد کامیونیتی»، میانبر «ساخت کارت»، لیست کارت‌های جدید.

### عضویت/ساخت کامیونیتی

- کاربر می‌تواند برای چند کامیونیتی «درخواست عضویت» ارسال کند.
- وضعیت درخواست: در انتظار → تأیید یا رد (توسط Community Manager).
- کاربر می‌تواند کامیونیتی جدید بسازد؛ سازنده به‌صورت خودکار Manager همان کامیونیتی است.
- Manager می‌تواند مدیران/Moderatorهای اضافی تعیین یا لغو کند.

### ساخت کارت «سفر» یا «بسته»

- کاربرِ واردشده می‌تواند کارت بسازد.
- هر کارت پیش‌فرض به همهٔ کامیونیتی‌ها نسبت داده می‌شود (نمایش سراسری).
- اختیاری: کاربر می‌تواند مشخص کند کارت در کدام کامیونیتی‌ها نمایش داده شود
- فیلدها: مبدأ، مقصد، تاریخ/بازه، وزن/ظرفیت، دسته‌بندی کالایی (مثلاً پوشاک/خوراکی/الکترونیک/…)، وضعیت بسته‌بندی (مثلاً «بدون بسته‌بندی» یا «بسته‌بندی‌شده»)، قیمت پیشنهادی، توضیح.

### مشاهده و جست‌وجوی کارت‌ها

- همهٔ کاربران کارت‌ها را سراسری می‌بینند (فارغ از عضویت).
- قید پیام‌دهی: کاربران فقط به صاحب کارت‌هایی پیام می‌دهند که با او حداقل یک کامیونیتی مشترک دارند.
- فیلترها: مبدأ، مقصد، تاریخ/بازه، وزن/ظرفیت، دسته‌بندی کالایی، وضعیت بسته‌بندی، کامیونیتی.
- مرتب‌سازی پیش‌فرض: جدیدترین.

### جزئیات کارت و پیامِ کنترل‌شده

- صفحهٔ جزئیات کارت با دکمهٔ «ارسال پیام» (به صاحب کارت).
- به صاحب کارت ایمیل اطلاع‌رسانی «پیام جدید دارید» ارسال می‌شود.
- سقف پیام روزانه برای هر کاربر (مثلاً ۵ پیام). پس از عبور، پیام راهنما/محدودسازی نمایش داده می‌شود.

### بلاک شخصی کاربران

- هر کاربر می‌تواند کاربران دیگر را به‌صورت شخصی بلاک کند (User Block).
- کاربر بلاک‌شده نمی‌تواند به کاربری که او را بلاک کرده پیام ارسال کند.
- **تفاوت با Ban سیستمی**: 
  - **Block شخصی (User Block)**: توسط خود کاربر انجام می‌شود و فقط بر تعامل بین دو کاربر تأثیر دارد.
  - **Ban سیستمی (System Ban)**: توسط مدیران کامیونیتی یا مدیران کل انجام می‌شود و دسترسی کاربر را به کل سیستم یا کامیونیتی محدود می‌کند.

### نوتیفیکیشن‌های پایه

- کاربر: تأیید ایمیل، انتشار موفق کارت، دریافت پیام جدید.
- مدیر کامیونیتی: اعلان «درخواست عضویت جدید» و یادآوری بررسی.
- کاربرِ درخواست‌دهنده: نتیجهٔ بررسی (تأیید/رد).
- مدیریتی: Ban/Unban و تغییر نقش.

### نقش‌ها و دسترسی‌ها

- **Member (عضو)**: دیدن سراسری کارت‌ها؛ ساخت کارت بدون نیاز به عضویت؛ مشاهدهٔ وضعیت درخواست‌های عضویت خودش؛ ارسال و دریافت پیام (با قید کامیونیتی مشترک).
- **Community Manager (مدیر کامیونیتی)**: تأیید/رد عضویت‌ها، Ban/Unban محلی، رسیدگی به گزارش محتوایی، افزودن/حذف مدیران اضافی.
- **Global Moderator (ناظر کل)**: Ban سراسری، دیدن گزارش‌ها، ساخت/مدیریت کامیونیتی در سطح سیستم (در صورت نیاز MVP).
- **Community Creator**: به‌صورت پیش‌فرض همان Manager همان کامیونیتی است.

### پنل ادمین

- فهرست کاربران، کامیونیتی‌ها، کارت‌ها، گزارش‌ها و درخواست‌های عضویت.
- تنظیمات: سقف پیام روزانه، SMTP/ارسال ایمیل.
- اقدامات: Ban/Unban سراسری، مشاهدهٔ لاگ‌های کلیدی.

### لاگ‌های پایه

- رویدادها: ثبت‌نام/تأیید ایمیل، ارسال/نتیجهٔ درخواست عضویت، ایجاد/انتشار کارت، ارسال پیام، Ban/Unban، ورود.
- برای رخدادهای حساس، ذخیرهٔ IP و User-Agent.

### صفحات محتوایی (WordPress، فقط لینک)

- صفحات محتوایی (درباره‌ما/قوانین/حریم خصوصی/وبلاگ) روی WordPress میزبانی می‌شوند.
- در اپ فقط لینک خارجی نمایش داده می‌شود (در هدر/فوتر/موارد لازم) و در تب جدید باز می‌شود.

---

## استک تکنولوژی

### بک‌اند (Python)

- **FastAPI**: فریم‌ورک سریع برای ساخت API. مزیت: مستندات آماده در /docs.
- **Pydantic**: تعریف مدل‌های ورودی/خروجی با اعتبارسنجی خودکار.
- **SQLAlchemy (یا SQLModel)**: اتصال راحت به دیتابیس و نوشتن کوئری.
- **Alembic**: ساخت/به‌روزرسانی جدول‌های دیتابیس (مایگریشن).
- **PostgreSQL**: دیتابیس اصلی (پایدار و استاندارد).
- **pydantic-settings**: خواندن تنظیمات حساس از .env (مثل رمزها).
- **FastAPI-Mail (یا SMTP ساده)**: ارسال ایمیل‌های OTP و نوتیف.
- **slowapi + Redis**: رِیت‌لیمیت (محدودکردن تعداد پیام/روز).
- **Uvicorn**: اجراکنندهٔ سرور FastAPI.
- **pytest + httpx**: تست واحد و تست API.

### فرانت‌اند (وب‌اپ)

- **Next.js + TypeScript**: ساخت صفحات و فرم‌ها (SSR/CSR).
- **TailwindCSS + shadcn/ui**: استایل‌دهی سریع و شیک.
- **TanStack Query**: گرفتن/کش‌کردن دادهٔ API (کاهش درخواست اضافی).
- **react-hook-form + zod**: فرم‌ها + اعتبارسنجی در سمت کاربر.
- **Vercel (میزبانی پیشنهادی)**: دیپلوی آسان فرانت‌اند.

### زیرساخت و سرویس‌ها

- **Neon یا Supabase Postgres**: دیتابیس مدیریت‌شده (بدون دردسر سرور).
- **Upstash Redis**: رِیت‌لیمیت و کش سبک.
- **Cloudflare R2 یا S3**: نگهداری فایل/عکس در صورت نیاز.
- **Sentry**: گزارش خطا و مانیتورینگ (بک‌اند و فرانت‌اند).
- **Logtail یا لاگ ساختاریافتهٔ ساده**: بررسی لاگ‌ها.
- **SMTP (Postmark/Resend/… یا سرور خودت)**: ارسال ایمیل‌های OTP/نوتیف.

### دیو‌اکس (تجربهٔ توسعه)

- **uv/venv + pip (یا Poetry)**: مدیریت پکیج‌های پایتون.
- **Black + Ruff + isort + mypy**: فرمت، لینت و چک تایپ کد پایتون.
- **ESLint + Prettier**: کیفیت کد فرانت‌اند.
- **GitHub Actions**: اجرای خودکار تست/لینت در هر کامیت.

